<!DOCTYPE html>
<html lang="en_US">
  <head>
		<meta charset="utf-8" />
		<meta name="viewport" content="initial-scale=1, width=device-width" />

		<script src="https://api.tiles.mapbox.com/mapbox-gl-js/v0.40.1/mapbox-gl.js"></script>
		<script src='https://unpkg.com/mapbox@1.0.0-beta10/dist/mapbox-sdk.min.js'></script>

		<!-- <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.2/mapbox-gl.css" rel="stylesheet" />		 -->
		
		<style type="text/css">
			/******************************************************************************/
			/*															Variables																			*/
			/******************************************************************************/
      :root {
        --white: #ffffff;
        --blue:  #009dac;
        --black: #000000;
        --gray:  #808080;
        --colorNone: transparent;

        --heightAside: 14rem;

        --sizeNone:     0rem;
        --sizeLogoHalf: 3rem;
        --sizeLogo:     calc(var(--sizeLogoHalf) * 2);

        --posLogoTop:   6.4rem;
      }


			@media (min-width: 10em) { :root {--bp: 'tiny'  } }
			@media (min-width: 25em) { :root {--bp: 'small' } }
			@media (min-width: 35em) { :root {--bp: 'medium'} }
			@media (min-width: 100em){ :root {--bp: 'large' } }
			@media (min-width: 120em){ :root {--bp: 'huge'  } }
			


			body::after {
				content: var(--bp, 'tiny');
				display: none;
			}

			html { font-size: 62.5%; }
			
			body, main, #coverSite {
				min-width:  100vw;
				min-height: 100vh;
				max-width:  100vw;
				max-height: 100vh;
				margin:  0;
				padding: 0;
			}

			body {
				font-size: 1.6rem;
        color:      var(--white);
        background: var(--black);
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
			}

			main {
				position: relative;
        background: var(--gray);
        z-index: 1;
      }

      #coverSite {
        position: absolute;
        pointer-events: all;
        opacity: 1;
        background: var(--black);
        z-index: 999;
        transition: opacity 1s ease-out;
        visibility: visible;
      }

      #coverSite.hidden {
        opacity: 0;
        pointer-events: none;
			}

			#map {
				position: relative;
				width: 100vw;
				height: 100vh;
				/* filter: grayscale(100) contrast(1) brightness(1); */
			}

			.zoomed-out #map .mapboxgl-canvas,
			            #map .mapboxgl-canvas{ filter: grayscale(100) contrast(1) brightness(.66); }
			.zoomed-in #map  .mapboxgl-canvas{ filter: grayscale(100) contrast(1) brightness(1); }


      /******************************************************************************/
			/*													Logo States & Settings 														*/
      /******************************************************************************/

      .logo {
        display: inline;
        width: var(--sizeLogo);
        color: var(--white);
      }

      .logo.centered {
        position: absolute;
        left: 50vw;
        top:  50vh;
        transform: translate(-50%, -50%);
        z-index: 1000;
			}

      /* Colors */
      .logo.light { color: var( --white ); }
      .logo.dark  { color: var( --black ); }
      .logo.blue  { color: var( --blue  ); }

      /* Loading */
      @-webkit-keyframes loadingLogo {
        0%   { opacity: 0; }
        100% { opacity: 1; }
      }
      @-moz-keyframes loadingLogo {
        0%   { opacity: 0; }
        100% { opacity: 1; }
      }
      @-o-keyframes loadingLogo {
        0%   { opacity: 0; }
        100% { opacity: 1; }
      }
      @keyframes loadingLogo {
        0%   { opacity: 0; }
        100% { opacity: 1; }
      }

      .logo.loading {
        opacity: 0;
        animation-name: loadingLogo;
        animation-duration: 1s;
        animation-direction: alternate;
        animation-timing-function: linear;
        animation-fill-mode: forwards;
        animation-iteration-count:infinite;
        animation-delay: 1s;
      }

      /* Logo To Top */
      @-webkit-keyframes topLogo {
        0%   { top: 50vh; }
        10%  { top: 50.5vh; }
        65%  { top: calc(var(--posLogoTop) - 1vh); }
        100% { top:      var(--posLogoTop);        }
      }
      @-moz-keyframes topLogo {
        0%   { top: 50vh; }
        10%  { top: 50.5vh; }
        65%  { top: calc(var(--posLogoTop) - 1vh); }
        100% { top:      var(--posLogoTop);        }
      }
      @-o-keyframes topLogo {
        0%   { top: 50vh; }
        10%  { top: 50.5vh; }
        65%  { top: calc(var(--posLogoTop) - 1vh); }
        100% { top:      var(--posLogoTop);        }
      }
      @keyframes topLogo {
        0%   { top: 50vh; }
        10%  { top: 50.5vh; }
        65%  { top: calc(var(--posLogoTop) - 1vh); }
        100% { top:      var(--posLogoTop);        }
      }

      .logo.top {
        opacity: 1;
        animation-name: topLogo;
        animation-duration: .75s;
        animation-direction: normal;
        animation-timing-function: ease-in-out;
        animation-fill-mode: forwards;
        animation-iteration-count: 1;
        animation-delay: 0s;
      }
			/******************************************************************************/
			/* Asset Logo SVG  for reuse - We hide this assest & use the <use xlink:href="#logo"> instead on the page */
      /******************************************************************************/
      #logo {
				width:  var(--sizeNone);
				height: var(--sizeNone);
				display: block;
			}

      #logo > * { fill: currentColor; }
      
			/******************************************************************************/
			/*														Debug Stuff																			*/
      /******************************************************************************/

      #grid {
        width: 100vw;
        height: 100vh;
        position: absolute;
        top: 0;
        z-index: 1001;
        pointer-events: none;
      }

      .hline, .vline {
        background-color: cyan;
        position: absolute;
      }

      .hline {
        top: 50%;
        left: 0;
        right: 0;
        height: 1px;
        transform: translate(0, -.5px);
      }

      .vline {
        top: 0;
        left: 50%;
        bottom: 0;
        width: 1px;
        transform: translate(-.5px, 0);
      }

			/* Show width and height in a panel */
			aside {
				position: fixed;
				border-radius: .25rem;
				background-color: rgba(0, 0, 0, 0.5);
				display: inline-block;
				color: #000;
				font-size: .75rem;
				line-height: 1.25rem;
				font-weight: 100;
				text-transform: none;
				padding: 0 .5rem;
				top:   .5rem;
				right: .5rem;
				z-index: 1003;
				text-transform: uppercase;
			}

			.tiny		aside	{ background: rgb(192, 239, 255); }
			.small 	aside { background: rgb(255, 165,   0); }
			.medium aside { background: rgb(255, 255,   0); }
			.large 	aside { background: rgb( 70, 255,  70); }
			.huge		aside { background: rgb(255,  43,  43); }

		</style>

		<script text="text/javascript">
			//global obj
			const $ = {
				body:   null,
				html:   null,
				win:    null,
				logo:   null,
				cover:  null,
				screen: null,
				map:    null,

				breakpoints: {
					tiny:   "tiny",
					small:  "small",
					medium: "medium",
					large:  "large",
					huge:   "huge",
				},

				size: "",

				SETUP:   {},
				LOADING: {},
				STATES:  {},
				COVER:   {},
				RESIZE:  {},
				ZOOM:    {},
				MAPBOX:  {},
				DEV: 		 {},
			};
			//set default size
			$.size = $.breakpoints.tiny;

			$.SETUP = {
				getElements: () => {
					$.body  = document.body;
					$.html  = document;
					$.win   = window;
					$.logo  = document.getElementById("veritasLogo");
					$.cover = document.getElementById("coverSite"  );
				},

				getMapBoxObjects: () => {
					$.MAPBOX.client = new MapboxClient($.MAPBOX.dataset.accessToken);
					$.MAPBOX.tiles  = mapboxgl;
					$.MAPBOX.tiles.accessToken = $.MAPBOX.api.accessToken;
					$.MAPBOX.client.listFeatures($.MAPBOX.dataset.id, {}, $.MAPBOX.datasetCallback);
				},

				mapClickHandler: () => {
					$.map = document.querySelector(".mapboxgl-canvas-container");
					$.map.addEventListener('click', (event) => {
						$.ZOOM.initial();
					});
				},

				logoClickHandler: () => {
					console.log("logoClickHandler");
					$.logo.addEventListener('click', (event) => {
						console.log("$.logo.addEventListener");
						$.ZOOM.office();
					});
				},
			}
			
			$.LOADING = {
				exitLoadingState: () => {
					// Get the opacity of the logo
					let logoOpacity = $.win.getComputedStyle($.logo, null).getPropertyValue("opacity");
					// Check if the logo opacity is lower then 95%, if so check again in 10 milliseconds
					if(logoOpacity < .95) { return setTimeout($.LOADING.exitLoadingState, 10);}
					// Logo is greater than 95% so remove loading animation & set loadingComplete state.
					$.STATES.loadingComplete();
				},
				
				logoTransitionToTop: () => {
					$.logo.classList.remove("loading");
					$.logo.classList.add("top");
				}
			}

			$.STATES = {
				loadingComplete: () => {
					// Move the logo to the top
					$.LOADING.logoTransitionToTop();
					// We need to also remove the site cover
					$.COVER.hide();
				}
			}
			
			$.COVER = {
				show: () => { $.cover.classList.remove( "hidden" ); },
				hide: () => { $.cover.classList.add(    "hidden" ); }
			}

			$.RESIZE = {
				
				getScreenSize: () => {
					$.screen = $.body.getBoundingClientRect();
				},

				//func to read/set CSS breakpoint ** may need to throttle this **
				handleResize: () => {
					console.log("Screen Resized");
					//read CSS psuedo element and it's after value
					const size = $.win.getComputedStyle($.body, ':after').getPropertyValue('content');
					//make sure to update panel size
					//check if size property changed, then update the class/remove previous setting
					if (size != $.size) {
						//loop breakpoints, find match to ensure tracking in JS
						Object.keys($.breakpoints).forEach((key) => {
							//match found
							if ($.breakpoints[key] == size) {
								//add new class, remove other
								$.body.classList.add(size);
								$.body.classList.remove($.size);
								//update global var
								$.size = size;
							}
						});
					}
					$.RESIZE.getScreenSize();
					if ($.DEV.enabled) $.DEV.updatePanelSize(); 
					return null;
				}
			}

			$.ZOOM = {
				to: (location) => {
					// Easy Out if we don't have what we need
					if( !location                               ) return;
					if( !$.MAPBOX.map                           ) return;
					if( location === $.MAPBOX.locations.current ) return;
					// * Fix! - Leave this for now Jake until we start mobile testing
					// updateLocationForOffset(location)
					$.MAPBOX.locations.current = location;
					console.log(location);

					if($.MAPBOX.map) $.MAPBOX.map.flyTo(location);

					// YO JAKE! Add this - It's in Framer
					//$.MAPBOX.toggleOfficeMarker((location === $.MAPBOX.locations.office) ? 'on' : 'off');
					
					return null;
				},

				initial: () => {
					$.ZOOM.to($.MAPBOX.locations.initial);
				},

				office: () => {
					console.log("!!!!!!!");
					$.ZOOM.to($.MAPBOX.locations.office);
				}

			};

			$.MAPBOX = {
				client:   		 null,
				tiles:    		 null,
				dataset:  		 null,
				map:      		 null,
				markers:			 {
					office:     null,
					locations: [] 
				},
				locations: 		 {
					current: null,
					office:  {},
					initial: {},
				},
				initialCenter: [],
				initialPitch:  0,
				initialZoom:   9.55,
				locationZoom:  13.5,
				locationPitch: 50,
				coordsOffice:  [-122.386888, 47.5791677],
				animation: {
					speed: 2
				},
				offset: {
					y: () => 32,
					x: () => ($.screen.width - 32) / 4
				},
				api: {
					accessToken: "pk.eyJ1IjoiamFrZWRvYnNvbiIsImEiOiJjajdzMHAwZ2Y0amhsMnFxdTgzZzRoa280In0.S2TkU2UgGv7dcsUsmy12cw"
				},
				dataset: {
					id: "cj8m9b6630wdy33rtnol47ydv",
					accessToken: "sk.eyJ1IjoiamFrZWRvYnNvbiIsImEiOiJjajhtYWkxaW4wd25kMndwZmc0ZG01b29lIn0.NPn9doCB7aiJpctcxiNiUA"
				},
				
				datasetCallback: (error, dataset) => {
					$.MAPBOX.dataset = dataset;
					$.MAPBOX.createMapAndEvent();
				},

				isReady: () => {
					$.SETUP.mapClickHandler();
					$.SETUP.logoClickHandler();
					$.MAPBOX.map.addSource("points", {
							"type": "geojson",
							"data": {
								"type": "FeatureCollection",
								"features": $.MAPBOX.dataset.features
							}
						});
					$.MAPBOX.setupLocations();
					$.MAPBOX.addMarkers();
					$.LOADING.exitLoadingState();
				},

				setupLocations: () => {
					$.MAPBOX.locations.office = {
						center: $.MAPBOX.coordsOffice,
						zoom:   $.MAPBOX.locationZoom,
						pitch:	$.MAPBOX.locationPitch,
						speed:  $.MAPBOX.animation.speed,
						offset: [-$.MAPBOX.offset.x(), $.MAPBOX.offset.y()] // Check! - ensure updates on Screen Resize
					}
					$.MAPBOX.locations.initial = {
						center: $.MAPBOX.initialCenter,
						zoom:   $.MAPBOX.initialZoom,
						pitch:	$.MAPBOX.initialPitch,
						speed:  $.MAPBOX.animation.speed,
						offset: [-$.MAPBOX.offset.x(), $.MAPBOX.offset.y()] // Check! - ensure updates on Screen Resize
					}
				},

				createMapAndEvent: () => {
					$.MAPBOX.getInitialCenter();
					$.MAPBOX.map = new $.MAPBOX.tiles.Map({
							container: "map",
							style:     "mapbox://styles/mapbox/satellite-v9?optimize=true",
							center: $.MAPBOX.initialCenter,
							zoom:   $.MAPBOX.initialZoom,
							pitch:  $.MAPBOX.initialPitch,
							interactive:        false,
							attributionControl: false,
							logoPosition: "bottom-right",
					});
					$.MAPBOX.initialOffset();
					$.MAPBOX.map.on("load", $.MAPBOX.isReady);
				},

				getInitialCenter: () => {
					//$.MAPBOX.locations = $.MAPBOX.dataset.features;
					let center = $.MAPBOX.dataset.features[0].geometry.coordinates;
					let bounds = {
						north: center[1],
						east:  center[0],
						south: center[1],
						west:  center[0]
					};

					$.MAPBOX.dataset.features.forEach((location) => {
						center = location.geometry.coordinates;

						if (bounds.west  > center[0]) bounds.west  = center[0];
						if (bounds.south > center[1]) bounds.south = center[1];
						if (bounds.east  < center[0]) bounds.east  = center[0];
						if (bounds.north < center[1]) bounds.north = center[1];
					});

					const diffLong   = (bounds.east  - bounds.west)  / 2;
					const diffLat    = (bounds.south - bounds.north) / 2;
					const centerLong = bounds.west   + diffLong;
					const centerLat  = bounds.north  + diffLat;
					return $.MAPBOX.initialCenter = [centerLong, centerLat];
				},

				initialOffset: () => {
					$.MAPBOX.map.panBy(
						[$.MAPBOX.offset.x(), -$.MAPBOX.offset.y()],
						{easing: () => 1 }
					);
				},

				addMarkers: () => {
					// Add All the locations from Mapbox
					$.MAPBOX.dataset.features.forEach((location, index) => {
						$.MAPBOX.setupMarker(location.geometry.coordinates, index);
					});
					// Add the Office, our Custom Property
					$.MAPBOX.setupMarker($.MAPBOX.locations.office.center, $.MAPBOX.dataset.features.length, true);
				},

				/**
					* Define what the function does on this line... then describe params and return val
					* @param  {Array}  coordinates
					* @param  {Number} index
					* @param  {Bool}   isOffice
					* @return {void}
					*/
				setupMarker: (coordinates, index, isOffice = false) => {
					const htmlMarker = $.MAPBOX.createHTMLMarker(index, isOffice);
					const marker     = new $.MAPBOX.tiles.Marker(htmlMarker).setLngLat(coordinates).addTo($.MAPBOX.map);

					htmlMarker.addEventListener('click', (event) => {
						// Remove all the markers that are active & set clicked marker to active
						document.querySelectorAll('.active').forEach((mrkr) => { mrkr.classList.remove('active'); });
						htmlMarker.classList.add('active');
						// Call function & Block event from triggering Map
						$.MAPBOX.markerClicked(htmlMarker);
						event.stopPropagation();
					});

					// Early Out for Office so we don't add as a location. It's added by hand.
					if (isOffice) return null;

					// Add Location to location Object
					$.MAPBOX.locations[`location${index}`] = {
						center: coordinates,
						pitch:  $.MAPBOX.locationPitch,
						zoom:   $.MAPBOX.locationZoom,
						speed:  $.MAPBOX.animation.speed,
						offset: [-$.MAPBOX.offset.x(), $.MAPBOX.offset.y()], // Check! - ensure updates on Screen Resize
					};
					return null;
				},

				createHTMLMarker: (index, isOffice) => {
					const m = document.createElement("div");
					// * Fix! - Need to finish the styling here after design is ready
					m.className								 = "marker";
					m.index 									 = index;
					m.isOffice 								 = isOffice;
					m.style.width              = "56px";
					m.style.height             = "56px";
					// * Fix! - These things should be set in a "DESIGN CONFIG Variable AND NOT MANAGED HERE"
					// m.style.width              = "#{SIZE.MARKER}px";
					// m.style.height             = "#{SIZE.MARKER}px";
					// m.style.backgroundSize     = "#{SIZE.PIN}";
					// m.style.backgroundImage    = "url(images/marker.png)";
					// m.style.backgroundColor    = "rgba(0,0,0,.33)";
					// m.style.boxShadow					 = "0 0 1px 1px rgba(255,255,255,.15), 0 0 0px 1px rgba(255,255,255,.10), inset 0 0 8px 1px rgba(000,000,000,1.0)";
					m.style.backgroundColor    = "#00A4B1";
					m.style.backgroundRepeat   = "no-repeat";
					m.style.backgroundPosition = "50%";
					m.style.borderRadius       = "50%";
					m.style.cursor             = "pointer";
					m.style.boxShadow					 = "0 0 1px 1px rgba(255,255,255,.15), 0 0 0px 1px rgba(255,255,255,.10), inset 0 0 8px 1px rgba(000,000,000,1.0)";

					if (isOffice) { 
						m.style.visibility = "hidden";
						$.MAPBOX.markers.office = m;
					} else {
						$.MAPBOX.markers.locations[index] = m;
					}

					return m;
				},

				markerClicked: (marker) => {
					if(marker === $.MAPBOX.markers.office) return null;

					// Log out marker & the location Data
					// console.log($.MAPBOX.markers.locations[marker.index]);
					// console.log($.MAPBOX.locations[`location${marker.index}`]);

					$.ZOOM.to($.MAPBOX.locations[`location${marker.index}`]); // setCameraTo(cameraLocation["location#{marker.index}"])
					// setHitAreaSelected(navLinks.projects)
					// secondaryTransition("show")

					return null;
				},
			}

			$.DEV = {
				enabled: true,
				//helper to vizualize page size by changing bg
				updatePanelSize: () => {
					let panel = document.getElementById('sizePanel');
					if(!panel){
						// <aside id="sizePanel"></aside>
						// createPanel by adding the aside via script
					}
					if(!$.screen.width && !$.screen.height) $.RESIZE.getScreenSize();
					panel.innerHTML = "<strong>" + $.size + "</strong> " + $.screen.width + "&times;" + $.screen.height;
				}
			}

		/******************************************************************************/
		/*													DOCUMENT EVENTS																		*/
		/******************************************************************************/

			window.addEventListener("resize", $.RESIZE.handleResize, false);
			document.addEventListener("DOMContentLoaded", (event) => {
				console.log("HTML Page Parsed");
				console.log($);
				$.SETUP.getElements();
				$.RESIZE.handleResize();
				$.SETUP.getMapBoxObjects();
				
			});
			window.addEventListener("load", (event) => {
				console.log("All resources finished loading!");
				/* TO DO --> load the MAP
				*/
			});
		
		</script>
  </head>
  <body>
		<aside id="sizePanel"></aside>

		<div id="grid">
      <div class="hline"></div>
      <div class="vline"></div>
    </div>

    <main>
      <svg id="veritasLogo" class="logo light loading centered" viewBox="0 0 32 32"><use xlink:href="#logo"></use></svg>
			<div id="coverSite"></div>
			<div id="map"></div> 
			<!-- .getElements to grab map-->
    </main>
    <svg id="logo" viewBox="0 0 56 60">
			<!-- Logo Asset: setup for reuse -->
    	<path id="mark" d="M49.4,9.8L32.2,1.9c-2.7-1.2-5.8-1.2-8.4,0L6.6,9.8c-3.3,1.5-5.5,4.8-5.5,8.3v24.2c0,3.6,2.2,6.9,5.6,8.4l17.2,7.5
		c1.3,0.6,2.7,0.8,4.1,0.8s2.8-0.3,4.1-0.8l17.2-7.5c3.4-1.5,5.6-4.8,5.6-8.4V18.1C54.9,14.6,52.7,11.3,49.4,9.8z M52.4,18.1v18.8
		l-14.7,9.4c-1.5,1-3.5,0.9-4.9-0.1l-11.8-8.3h20.9l0.2,0c3.5,0,6.4-2.6,6.7-5.9c0-0.3,0.1-0.6,0.1-0.9l-0.1-18.9
		C50.9,13.4,52.4,15.7,52.4,18.1z M37.8,22c1.3,0.8,2.1,2.3,2.1,3.8v9.6l-3.7,0v-3.8c0-0.7-0.6-1.3-1.3-1.3s-1.3,0.6-1.3,1.3v3.8
		l-16.7,0V24.1c0,0,0-0.1,0-0.1l11.8-7.4L37.8,22z M31.2,4.2l15,6.9l0.1,20c0,0.2,0,0.4,0,0.6c-0.2,1.9-1.8,3.4-3.8,3.6v-7.1
		c0-0.1,0-0.2,0-0.3V16.8c0-2.7-1.6-4.1-3.3-5.1c0,0,0,0-0.1,0l-14-7.6C26,3.7,27,3.5,28,3.5C29.1,3.5,30.2,3.8,31.2,4.2z M7.7,12.1
		l14.6-6.7l15.6,8.5c1.6,1,2.1,1.7,2.1,3v3.7c-0.3-0.2-0.6-0.4-0.9-0.6l-12.4-7.5c-2.2-1.3-5-1.3-7.2,0L3.6,21.7v-3.6
		C3.6,15.6,5.2,13.2,7.7,12.1z M3.6,42.3V24.6l17.1-10.1c1.4-0.8,3.2-0.8,4.6,0l1,0.6l-15.2,9.5c-2,1.3-3.3,3.5-3.3,5.9v17.9
		l-0.2-0.1C5.3,47.2,3.6,44.9,3.6,42.3z M24.9,55.8l-14.5-6.3v-19c0-1.5,0.8-3,2.1-3.8l1.9-1.2v15.2c0,2.3,1.1,4.4,3,5.7l13.6,9.4
		l0,0C29.1,56.7,26.9,56.7,24.9,55.8z M48.2,48.3l-14.4,6.3L18.9,44.3c-1.2-0.8-1.9-2.2-1.9-3.6v-2.4l14.3,10c1.2,0.8,2.6,1.3,4,1.3
		c1.3,0,2.6-0.4,3.8-1.1l13.3-8.5v2.4C52.4,44.9,50.7,47.2,48.2,48.3z" />
    	<!-- <path id="tm" d="M50.5,6.1h-0.8V5.8h2v0.4h-0.8v2.2h-0.4V6.1z M52.3,5.8h0.4l0.9,1.4l0.9-1.4h0.4v2.6h-0.4v-2l-0.9,1.4h-0.1l-0.9-1.4v2
			h-0.4V5.8z" /> -->
    </svg>
  </body>
</html>


<!--

********************************************************************************
*   																																					 *
*   																	TODO																		 *
*   																																					 *
********************************************************************************

	- edge gradients
	- modernizer framework?
	- siteleaf build

-->
